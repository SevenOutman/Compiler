function extend(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function $defined(e){return void 0!==e}function FileManager(){function e(e,t,n){var r=this;r.isNew=ko.observable($defined(n)?n:!0),r.name=ko.observable($defined(e)?e.replace(/(\.toy)$/,""):"untitled"),r.content=ko.observable(t||""),r.fileName=ko.computed(function(){return r.isNew()?r.name():r.name()+".toy"}),r.serialize=function(){return JSON.stringify({name:r.name(),content:r.content()})}}e.example=function(){return new e("example","{\n    int a;\n    real b;\n    a = 1;\n    b = 2.0;\n    if (a > b) then {\n        b = a;\n    } else {\n        b = b - a;\n    }\n}",!1)};var t=this;t.files=ko.observableArray([]);var n=[];t.newFile=function(){var t=new e;return n.push(t),t},t.findFile=function(e){for(var n=0,r=t.files(),i=r.length;i>n;n++)if(r[n].fileName()==e)return r[n]},t.saveFile=function(e){e.isNew()&&(t.files.push(n.pop()),e.isNew(!1)),Storage.setItem(e.fileName(),e.serialize())},t.deleteFile=function(e){t.files.remove(e),Storage.removeItem(e.fileName())},t.load=function(){for(var n=JSON.parse(Storage.getItem("stored-files")||"[]"),r=0,i=n.length;i>r;r++){var o=Storage.getItem(n[r]);if(o){var a=JSON.parse(o);t.files.push(new e(a.name,a.content,!1))}}t.files().length||t.files.push(e.example())},t.save=function(){for(var e=[],n=0,r=t.files(),i=r.length;i>n;n++)t.saveFile(r[n]),e[e.length]=r[n].fileName();Storage.setItem("stored-files",JSON.stringify(e))},t.load()}function EditorViewModel(e){function t(e){var t=this;t.file=e,t.isActive=ko.observable(!1),t.cachedContent=ko.observable(t.file.content()),t.unsaved=ko.computed(function(){return t.cachedContent()!=t.file.content()}),t.cursorPosition=ko.observable({line:0,ch:0}),t.history={done:[],undone:[]}}function n(e,t){var n=this;n.isOpen=ko.observable(!1);var r=null;n.name=ko.observable(""),n.rename=function(e){r=e,n.name(r.name()),n.isOpen(!0),$("#filename").select()},n.reset=function(){r=null,n.name("")},n.cancel=function(){n.isOpen(!1),n.reset()},n.confirm=function(){var i=n.name();if(e.findFile(i+".toy")&&!confirm("File '"+i+".toy' already exists. Want to overwrite?"))return $("#filename").select(),!1;r.name(n.name()),e.saveFile(r);var o=t.activeTab();o&&r==o.file&&(o.cachedContent(t.getEditorContent()),o.file.content(o.cachedContent()),e.saveFile(o.file)),n.isOpen(!1),n.reset()}}var r=this;r.renameDialog=new n(e,r),r.cm=CodeMirror.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,mode:"toy",indentUnit:4,theme:"monokai-so",autoCloseBrackets:!0,matchBrackets:!0,styleActiveLine:!0,showCursorWhenSelecting:!0,scrollbarStyle:"overlay",selectionPointer:!0,styleSelectedText:!0}),r.cm.on("change",function(e,t){var n=r.activeTab();n&&n.cachedContent(r.getEditorContent())}),r.cm.on("cursorActivity",function(e){var t=r.activeTab();t&&t.cursorPosition(e.doc.getCursor())}),r.getEditorContent=function(){return r.cm.getValue()},r.setEditorContent=function(e){return r.cm.setValue(e)},r.tabs=ko.observableArray([]),r.activeTab=ko.observable(),r.setActive=function(e){var t=r.activeTab();t!=e&&(t&&(t.cursorPosition(r.cm.doc.getCursor()),t.history=r.cm.doc.getHistory(),t.cachedContent(r.getEditorContent()),t.isActive(!1)),r.activeTab(e),e&&(e.isActive(!0),r.setEditorContent(e.cachedContent()),r.cm.doc.setHistory(e.history),r.cm.doc.setCursor(e.cursorPosition()),r.cm.focus()))},r.unsaved=ko.computed(function(){var e=r.activeTab();return e&&e.unsaved()}),r.saveActiveTab=function(){var t=r.activeTab();(t.unsaved()||t.file.isNew())&&(t.file.isNew()?r.renameDialog.rename(t.file):(t.cachedContent(r.getEditorContent()),t.file.content(t.cachedContent()),e.saveFile(t.file)))},CodeMirror.commands.save=function(){r.saveActiveTab()},r.openNewFile=function(){r.openFile(e.newFile())},r.openFile=function(e){for(var n=0,i=r.tabs(),o=i.length;o>n;n++){var a=i[n];if(a.file==e)return void r.setActive(a)}var a=new t(e);r.tabs.push(a),r.setActive(a)},r.closeTab=function(e){r.tabs.remove(e),r.activeTab()==e&&r.setActive(r.tabs().rear())},r.findFileTab=function(e){for(var t=0,n=r.tabs(),i=n.length;i>t;t++)if(n[t].file==e)return n[t]},r.cursorPosText=ko.computed(function(){var e=r.activeTab();if(e){var t=e.cursorPosition();return t.line+1+":"+(t.ch+1)}return""}),r.isLocked=ko.observable(!1),r.lock=function(){r.isLocked(!0),r.cm.setOption("readOnly","nocursor")},r.unlock=function(){r.isLocked(!1),r.cm.setOption("readOnly",!1)},r.load=function(){var t=JSON.parse(Storage.getItem("opened-files")||"[]"),n=Storage.getItem("last-editing");t.push(n);for(var i=0,o=t.length;o>i;i++){var a=t[i],s=e.findFile(a);s&&r.openFile(s)}},r.save=function(){for(var e=[],t=0,n=r.tabs(),i=n.length;i>t;t++){var o=n[t];e[e.length]=o.file.fileName(),o.isActive()&&Storage.setItem("last-editing",o.file.fileName())}Storage.setItem("opened-files",JSON.stringify(e))},r.load()}function WorkspaceViewModel(e,t){function n(e){var t=this;t.file=e,t.attrId=ko.computed(function(){return"toy-"+t.file.name()}),t.isActive=ko.observable(!1)}var r=this,i=$(".left-box");r.rows=ko.computed(function(){return $.map(e.files(),function(e){return new n(e)})});var o=null;r.setActive=function(e){o&&o.isActive(!1),(o=e).isActive(!0)},r.openFileInEditor=function(e){t.isLocked()||t.openFile(e.file)},r.importFile=function(){var t=new FileReader,n=null;t.onload=function(){null!==n&&(n.content(this.result),e.files.push(n),r.openFileInEditor(n),n=null)};var i=$(document.createElement("input")).attr({type:"file"});i.on("change",function(){var e=$(this)[0].files[0];n=new ToyFile(e.name.replace(/(\.\w+)?$/,".toy")),n.isNew(!1),t.readAsText(e)}),i.trigger("click")},r.renameFile=function(n){var r=e.findFile(n);r&&t.renameDialog.rename(r)},r.confirmDeleteFile=function(n){var r=e.findFile(n);if(r&&confirm("Are you sure to delete '"+r.fileName()+"'?")){var i=t.findFileTab(r);i&&t.closeTab(i),e.deleteFile(r)}},r.isOpen=ko.observable(!0),r.open=function(){i.hasClass("hidden")&&(r.isOpen(!0),i.css("width","200px"),$(".center-box").css("margin-left","200px"))},r.close=function(){r.isOpen(!1),$(".center-box").css("margin-left","0")}}function Openable(){var e=this;e.isOpen=ko.observable(!1),e.open=function(){e.isOpen(!0)},e.close=function(){e.isOpen(!1)}}function ConsoleViewModel(){function e(e,t){return e+t.replace(/\s*\n/g,"\n  ")+"\n"}function t(e,t){return e.split("\n").slice(-t).join("\n")}var n=this,r=$(".bottom-box");n.cm=CodeMirror.fromTextArea(document.getElementById("console"),{theme:"monokai-so",mode:"console",readOnly:"nocursor",scrollbarStyle:"overlay",viewportMargin:1/0}),n.scollToEnd=function(){n.cm.scrollIntoView(n.cm.doc.lastLine(),1)},n.cm.on("change",function(e){e.scrollIntoView(e.doc.lastLine(),1)}),n.log=function(r){n.cm?n.cm.setValue(t(n.cm.getValue()+e(": ",r),1e3)):window.console.log(r)},n.outputWithAddon=function(r,i){i&&(n.cm?(i instanceof Object&&(i=i.toString()),n.cm.setValue(t(n.cm.getValue()+e(r,i),1e3))):window.console.log(i))},n.error=function(e){n.outputWithAddon("- ",e)},n.success=function(e){n.outputWithAddon("+ ",e)},n.warn=function(e){n.outputWithAddon("+ ",e)},n.clear=function(){n.cm.setValue("")},n.isOpen=ko.observable(!1),n.open=function(e){n.isOpen(!0),r.css("height","30%"),$(".upper-box").css("height","70%"),e||P("treeboxresized"),n.cm.focus()},n.close=function(){n.isOpen(!1),$(".upper-box").css("height","100%"),P("treeboxresized")},n.expand=function(){$(".upper-box").css("height","0"),r.css("height","100%")}}function UIViewModel(e,t,n,r,i){var o=this,a=ko.observable(!1);o.compileMode=ko.computed({read:function(){return a()},write:function(o){a(o),o?(e.lock(),t.close(),i.open(),r.open(),n.open(),n.clear()):(r.close(),i.close(),t.open(),e.unlock())}}),o.initResizables=function(){function e(e){if(t instanceof HTMLElement){var r=$(t).parent(".resizable");if(r[0]instanceof HTMLElement){var o=$("#main"),a=($(".left-box"),$(".right-box")),s=$(".center-box"),l=$(".upper-box"),c=($(".bottom-box"),$(".editor-box")),u=$(".tree-box");if(r.hasClass("left-box")){var f=e.clientX,p=Math.mid(f+i+5,1,o.width()-a.width()-1);r.width(p-1),s.css("margin-left",p+"px")}if(r.hasClass("right-box")){var f=e.clientX,m=Math.mid(o.width()-(f+i+5),1,o.width()-u.width()-1);r.width(m-1),s.css("margin-right",m+"px")}if(r.hasClass("bottom-box")){var d=e.clientY,h=Math.mid(d+n+5-$(".navbar").height(),0,o.height()-r.children(".box-header").height()-1);r.height(o.height()-h),l.height(h)}if(r.hasClass("tree-box")){var f=e.clientX,m=Math.mid(s.width()-(f+i+5),1,s.width()-1);r.width(m-1),r.children(".box-body").css("padding-left",Math.max(0,(m-551)/2)+"px"),c.css("margin-right",m+"px")}}}}var t=null,n=0,i=0,o=$(document),a=$(document.body);$.each($(".resizer"),function(s,l){$(l).on("mousedown",function(s){t=l,n=$(t).offset().top-s.clientY,i=$(t).offset().left-s.clientX,a.css("cursor",$(t).css("cursor")),o.on("mousemove",e),o.on("mouseup",function(){var e=$(t).parent(".resizable");(e.hasClass("bottom-box")||e.hasClass("tree-box"))&&r.resizePen(),t=null,o.off("mousemove"),a.css("cursor","")})})}),document.getElementById("resizing-mask").addEventListener("mousemove",function(e){},!1)},o.initResizables()}function ParseTreeViewModel(){var e=this,t=$(".tree-box"),n=t.find(".box-body"),r=new Tree("tree-pane",{radius:10});r.clear=function(){return r.canvas.clear(),r},r.reset=function(){r.setSource([["0","program",1,"","1","0"]])},r.resize=function(){r.render({width:n.width(),height:n.height()})},S("treeboxresized",function(){e.resizePen()}),e.resizePen=function(){e.isOpen()&&!e.showAssembly()&&r.resize()},e.pen=r,e.showAssembly=ko.observable(!1);var i={};i.cm=CodeMirror.fromTextArea(document.getElementById("assembly"),{theme:"monokai-so",mode:"console",readOnly:"nocursor",scrollbarStyle:"overlay",viewportMargin:1/0}),e.assembly={show:function(t){e.showAssembly(!0),i.cm.setValue(t)}},e.isOpen=ko.observable(!1),e.open=function(){e.isOpen(!0),t.css("width","550px"),$(".editor-box").css("margin-right","550px"),e.pen.reset(),e.pen.resize()},e.close=function(){e.isOpen(!1),t.children(".box-body").css("padding-left","0"),$(".editor-box").css("margin-right","0"),e.showAssembly(!1)}}function SymbolTableViewModel(e){function t(t){var r=this;r.name=ko.observable(t.name),r.type=ko.observable(t.type),r.positions=ko.observableArray($.map(t.positions,function(e,t){return new n(e,t)})),r.attrId=ko.computed(function(){return"symbol-"+r.name()}),r.rowText=ko.computed(function(){return"type: "+r.type()+", occurance: "+r.positions().length}),r.update=function(t){r.name(t.name),r.type(t.type);for(var i=r.positions().length;i<t.positions.length;i++){var o=t.positions[i];r.positions.push(new n(o,i)),r.isActive()&&e.cm.doc.addSelection({line:o.first_row-1,ch:o.first_col-1},{line:o.last_row-1,ch:o.last_col-1})}},r.isActive=ko.observable(!1),r.isActive.subscribe(function(t){if(t)for(var n=0,i=r.positions(),o=i.length;o>n;n++){var a=i[n].position;0===n?e.cm.doc.setSelection({line:a.first_row-1,ch:a.first_col-1},{line:a.last_row-1,ch:a.last_col-1}):e.cm.doc.addSelection({line:a.first_row-1,ch:a.first_col-1},{line:a.last_row-1,ch:a.last_col-1})}}),r.isOpen=ko.observable(!1),r.toggle=function(){r.isOpen(!r.isOpen())}}function n(t,n){var r=this;r.position=t,r.rowText="["+(n+1)+"] line: "+t.first_row+", ch: "+t.first_col,r.isActive=ko.observable(!1),r.isActive.subscribe(function(e){e&&r.highlight()}),r.highlight=function(){e.cm.doc.setSelection({line:t.first_row-1,ch:t.first_col-1},{line:t.last_row-1,ch:t.last_col-1})}}var r=this,i=$(".right-box");r.symbols=ko.observableArray([]),r.updateSymbols=function(e){for(var n=r.symbols(),i=0;i<n.length;i++)n[i].update(e[i]);for(var i=n.length;i<e.length;i++)r.symbols.push(new t(e[i]))};var o=null;r.setActive=function(e){o&&o.isActive(!1),(o=e).isActive(!0)},r.isOpen=ko.observable(!1),r.open=function(){r.isOpen(!0),i.css("width","350px"),$(".center-box").css("margin-right","350px")},r.close=function(){r.isOpen(!1),$(".center-box").css("margin-right","0"),e.cm.doc.setSelection({line:0,ch:0})}}function Processor(e,t,n){var r=this,i=r.paxer=Paxer["new"](),o=r.semantic=new SemanticAnalyzer;r.compilee=ko.observable(null),r.compile=function(t){r.compilee(t),t&&(Cache.st={},n.symbols([]),e.log("Compile '"+t.fileName()+"'..."),r.paxer.setInput(t.content()))},r.preprocesscode=function(e){var t,n=/(\+|\-|\*|\/|!=|>=?|<=?|==?)/g,r=/(\(|\)|\{|}|;|,|\$)/g;return e=e.replace(/\n/g," ").replace(n," $1 ").replace(r," $1 ").replace(/[ ]+/g," ").replace(/(else|then)\s+\{/g,"$1{").replace(/}\s+(else)/,"}$1").trim()+" ",t=e.replace(/(then|else|then\{|else\{|}else\{|\{|}|;)\s/g,"$1\n").replace(/\s+(,|;|\))/g,"$1").replace(/\(\s+/g,"(").replace(/(then|else)\{/g,"$1 {").replace(/}(else)/,"} $1")},r.compileNext=function(){var r=i.getStatus();if("DONE"!=r&&"ERROR"!=r){switch(i.go(),r=i.getStatus()){case"DONE":return o.eat(i.getRootS(),i.getSymbolTable()),e.success(i.getCurMovementF()),e.success("code parsed."),e.warn(i.getWarningMsg()),e.error(o.getErrorMsg()),void t.assembly.show(o.getAssembly());case"ERROR":return void e.error(i.getErrMsg());case"WARNING":case"NORMAL":e.success(i.getCurMovementF()),t.pen.setSource(i.getSequentialNodes()),t.pen.render()}return n.updateSymbols(i.getSymbolTable()),r}},r.compileFF=function(){var r=i.getStatus();if("DONE"==r)e.success("code parsed.");else if("ERROR"==i.getStatus())e.error(i.getErrMsg());else{for(Benchmark.mark("parse");"DONE"!=i.getStatus()&&"ERROR"!=i.getStatus();)i.go();switch(r=i.getStatus()){case"DONE":o.eat(i.getRootS(),i.getSymbolTable());var a=Benchmark.measure("parse");t.assembly.show(o.getAssembly()),e.success(i.getMovementsF()),e.warn(i.getWarningMsg()),e.error(o.getErrorMsg()),e.success("Compile finished in "+a.toFixed(4)+" millisecs."),e.success("Can we make it faster?");break;case"ERROR":e.error(i.getErrMsg())}}return n.updateSymbols(i.getSymbolTable()),r}}function ControlsViewModel(e,t,n,r,i,o){var a=this;a.needSave=ko.computed(function(){return t.unsaved()}),a.save=function(){t.saveActiveTab()},a.tidy=function(){var e=t.getEditorContent();t.setEditorContent(i.preprocesscode(e));for(var n=0;n<t.cm.doc.lastLine();n++)t.cm.indentLine(n,"smart");t.cm.focus()},a.importFile=function(){n.importFile()},a.compile=function(){var e=t.activeTab();if(e){t.saveActiveTab();var n=e.file;if(n.isNew())return;i.compile(n),o.compileMode(!0)}},a.stop=function(){i.compile(null),o.compileMode(!1)},a.next=function(){i.compileNext()},a.ff=function(){i.compileFF()}}function MainViewModel(){var e=this,t=e.fileManager=new FileManager,n=e.editor=new EditorViewModel(t),r=e.workspace=new WorkspaceViewModel(t,n),i=e.console=new ConsoleViewModel,o=e.parseTree=new ParseTreeViewModel,a=e.symbolTable=new SymbolTableViewModel(n),s=e.processor=new Processor(i,o,a),l=e.ui=new UIViewModel(n,r,i,o,a);e.controls=new ControlsViewModel(t,n,r,i,s,l);e.aboutCard=new Openable,e.openMenu=new Openable,e.openMenu.open=function(t,n){n.stopPropagation(),e.openMenu.isOpen(!0),$(document).one("click",function(){e.openMenu.close()})}}function ToyFile(e,t,n){this.isNewFile=void 0!==n?n:!0,this.name=void 0!==e?e.replace(/(\.toy)$/,""):"untitled",this.content=t||"",this.tree=null,this.assembly=null}function SemanticAnalyzer(){function e(e,t,n,r){var i=null===t?"":t,o=null===n?"":n,a=null===r?"":r;return 3==e.length?e+=" ":2==e.length&&(e+="  "),["    ",e," ",i,", ",o,", ",a].join("")}function t(u){var f,p,m,d=r.rear();switch(r.push(u),u["abstract"]){case"program":t(u.subNodes[0]);break;case"compoundstmt":t(u.subNodes[1]);break;case"stmts":t(u.subNodes[0]),u.subNodes[1]&&t(u.subNodes[1]);break;case"stmt":t(u.subNodes[0]);break;case"decl":u.value=t(u.subNodes[0]).value,t(u.subNodes[1]);break;case"type":u.value=u.subNodes[0]["abstract"];break;case"list":u.value=d.value,t(u.subNodes[0]),t(u.subNodes[1]);break;case"ID":var h=n.get(u.name);switch(void 0===h.occurance?h.occurance=0:h.occurance++,d["abstract"]){case"list":u.type=d.value,h.type&&o.push(new SemanticError("Duplicated declaration of '"+h.name+"'",h.positions[h.occurance])),h.type=u.type;break;default:h.type||0!==h.occurance||o.push(new SemanticError("Undeclared identifier '"+h.name+"'",h.positions[h.occurance]))}break;case"list1":u.value=d.value,u.subNodes[1]&&t(u.subNodes[1]);break;case"assgstmt":u.value=t(u.subNodes[2]).value;var v=t(u.subNodes[0]).name;i[i.length]=e("mov",v,null,u.value);break;case"arithexpr":if(f=t(u.subNodes[0]),p=t(u.subNodes[1]),p.type)switch(p.type){case"+":u.value=c(a++),i[i.length]=e("add",u.value,f.value,p.value);break;case"-":u.value=c(a++),i[i.length]=e("sub",u.value,f.value,p.value)}else u.value=f.value;break;case"multexpr":if(f=t(u.subNodes[0]),p=t(u.subNodes[1]),p.type)switch(p.type){case"*":u.value=c(a++),i[i.length]=e("mul",u.value,f.value,p.value);break;case"/":u.value=c(a++),0===p.value?(o.push(new SemanticError("Cannot be divided by 0")),i[i.length]=e("*div",u.value,f.value,p.value)):i[i.length]=e("div",u.value,f.value,p.value)}else u.value=f.value;break;case"arithexprprime":if(u.subNodes[2])if(u.type=u.subNodes[0]["abstract"],f=t(u.subNodes[1]),p=t(u.subNodes[2]),p.type)switch(p.type){case"+":u.value=c(a++),i[i.length]=e("add",u.value,f.value,p.value);break;case"-":u.value=c(a++),i[i.length]=e("sub",u.value,f.value,p.value)}else u.value=f.value;break;case"simpleexpr":if(u.subNodes[1])u.value=t(u.subNodes[1]).value;else{var g=t(u.subNodes[0]);switch(g["abstract"]){case"ID":u.value=g.name;break;case"NUM":u.value=g.value}}break;case"multexprprime":if(u.subNodes[2])if(u.type=u.subNodes[0]["abstract"],f=t(u.subNodes[1]),p=t(u.subNodes[2]),p.type)switch(p.type){case"*":u.value=c(a++),i[i.length]=e("mult",u.value,f.value,p.value);break;case"/":u.value=c(a++),0===p.value?(o.push(new SemanticError("Cannot be divided by 0")),i[i.length]=e("*div",u.value,f.value,p.value)):i[i.length]=e("div",u.value,f.value,p.value)}else u.value=f.value;break;case"whilestmt":var b=u.subNodes[2],w=u.subNodes[4],x=s++;i[i.length]=l(x),t(b),t(w),i[i.length]=e("jmp",null,null,"f"+x);break;case"boolexpr":u.value="t"+a++,m=u.subNodes[1];var y=u.subNodes[0],N=u.subNodes[2];switch(f=t(y),p=t(N),t(m).value){case"<":i[i.length]=e("lt",u.value,f.value,p.value);break;case">":i[i.length]=e("gt",u.value,f.value,p.value);break;case"<=":i[i.length]=e("le",u.value,f.value,p.value);break;case">=":i[i.length]=e("ge",u.value,f.value,p.value);break;case"==":i[i.length]=e("eq",u.value,f.value,p.value)}i[i.length]=e("jmpf",u.value,null,"f"+s);break;case"boolop":u.value=u.subNodes[0]["abstract"];break;case"ifstmt":m=u.subNodes[2];var E=u.subNodes[5],S=u.subNodes[7];t(m),t(E),i[i.length]=e("jmp",null,null,"f"+(s+1)),i[i.length]=l(s++),t(S)}return r.pop(),u}var n,r,i,o,a=0,s=0,l=function(e){return"f"+e},c=function(e){return"t"+e},u=function(){n=null,r=[],o=[],i=[],a=0,s=0},f=function(e,r){u(),n=r,n.get=function(e){for(var t=0;t<n.length;t++)if(n[t].name==e)return n[t]},t(e),s>0&&(i[i.length]=l(s))};return{eat:f,getErrorMsg:function(){return o.join("\n")},getAssembly:function(){return i.join("\n")}}}function SemanticError(e,t){this.msg=e,this.position=t}var Benchmark=function(e){var t={},n=function(n){t[n]=e.performance?e.performance.now():(new Date).getTime()},r=function(n){var r=e.performance?e.performance.now():(new Date).getTime();return r-t[n]},i=function(e,t,i){n("test");for(var a=0;t>a;a++)e.apply(i||this,Array.prototype.slice.call(arguments,3));var s=r("test");return o("test"),s},o=function(e){delete t[e]};return{mark:n,measure:r,test:i,clear:o}}(window);const Invalid=void 0;Array.prototype.has=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return!0;return!1},Array.prototype.rear=function(){return this[this.length-1]},Array.prototype.front=function(){return this[0]},Array.prototype.remove=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return this.splice(t,1)},String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";var t="",n=this;if(1>e)return t;for(;e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n}),Math.mid=function(e,t,n){if(3!=arguments.length)throw new Error("Math.mid requires exactly 3 arguments.");return[e,t,n].sort(function(e,t){return e-t})[1]};var _randomString=function(e){if(e>5)return _randomString(e-5)+_randomString(5);for(var t,n,r="",i=Math.pow(64,e),o=Math.floor(Math.random()*i),a=51/63;r.length<e;)t=o%64,n=Math.floor(t*a),o=(o-t)/64,r+=String.fromCharCode(65+(n>25?n+6:n));return r};!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("toy",function(e,t){function n(e,t){var n=e.next();return a.test(n)?(e.eatWhile(/^[*+\-<>!=\/]/),/^\/\//.test(e.current())?(e.skipToEnd(),"comment"):"operator"):/\d/.test(n)?(e.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),"number"):i.test(n)?(e.eatWhile(i),o.test(e.current())?"keyword":"variable"):null}var r=e.indentUnit,i=t.wordCharacters||/[\w$\xa1-\uffff]/,o=/\b(int|real|if|else|then|while)\b/,a=/^(\+|\-|\*|\/|>=?|<=?|==?)$/;return{startState:function(){return{indentStack:[]}},token:function(e,t){if(e.eatSpace())return null;var r=n(e,t),i=e.current();return["{","then","else"].has(i)?("{"==i&&"{"!=t.indentStack.rear()&&t.indentStack.pop(),t.indentStack.push(i)):"}"===i?"{"==t.indentStack.rear()&&t.indentStack.pop():";"===i&&["else","then"].has(t.indentStack.rear())&&t.indentStack.pop(),r},indent:function(e,t){var n=t&&t.charAt(0);return"}"==n&&"{"==e.indentStack.rear()&&e.indentStack.pop(),e.indentStack.length*r},electricInput:/^\s*(?:\{|})$/}})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("console",function(e,t){var n={"+":"positive","-":"negative",":":"comment","@":"def"};return{startState:function(){return{ctx:n[":"]}},token:function(e,t){var r=e.string.search(/[\t ]+?$/);if(!e.sol()||0===r)return e.skipToEnd(),t.ctx;var i=n[e.peek()]||e.skipToEnd();-1===r?e.skipToEnd():e.pos=r;var o=t.ctx=i||t.ctx;return o}}})}),function(e){var t={},n=function(e,n){if(e&&t[e])for(var r=0;r<t[e].length;r++)setTimeout(function(e,t){return function(){e.apply(t,n)}}(t[e][r],this),0)},r=function(e,n){"function"==typeof n&&(t[e]||(t[e]=[]),t[e].push(n))};e.P=function(e){return n(e,Array.prototype.slice.call(arguments,1)),{p:P}},e.S=function(e,t){return r(e,t),{s:S}}}(window);var Storage=function(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),t}catch(n){return t=function(){var e={};return{setItem:function(t,n){return e[t]=String(n),e[t]},getItem:function(t){return e.hasOwnProperty(t)?this._data[t]:void 0},removeItem:function(t){return delete e[t]},clear:function(){return e={}}}}()}}(),Cache={};ToyFile.prototype.extension=".toy",ToyFile.prototype.fileName=function(){return this.isNewFile?this.name:this.name+this.extension},ToyFile.prototype.serialize=function(){return JSON.stringify({name:this.name,content:this.content})};var SymbolTable={"new":function(){var e,t,n={},r=0;return n.handle=function(n){function i(n){var i={name:n.lexeme,type:void 0,value:void 0,positions:[n.position]};e.push(i),t[n.lexeme]=r,r+=1}function o(n){e[t[n.lexeme]].positions.push(n.position)}e.hasOwnProperty(t[n.lexeme])?o(n):i(n)},n.reset=function(){e=[],t={},r=0},n.get=function(){return e.slice()},n.getD=function(){},n.getLength=function(){return r},n}},Lexer={"new":function(){var e,t,n,r,i,o,a,s,l=[{regExp:/^int$/,"abstract":"int",containValue:"false"},{regExp:/^real$/,"abstract":"real",containValue:"false"},{regExp:/^if$/,"abstract":"if",containValue:"false"},{regExp:/^then$/,"abstract":"then",containValue:"false"},{regExp:/^else$/,"abstract":"else",containValue:"false"},{regExp:/^while$/,"abstract":"while",containValue:"false"},{regExp:/^\($/,"abstract":"(",containValue:"true"},{regExp:/^\)$/,"abstract":")",containValue:"true"},{regExp:/^\{$/,"abstract":"{",containValue:"true"},{regExp:/^\}$/,"abstract":"}",containValue:"true"},{regExp:/^,$/,"abstract":",",containValue:"true"},{regExp:/^;$/,"abstract":";",containValue:"true"},{regExp:/^\+$/,"abstract":"+",containValue:"true"},{regExp:/^-$/,"abstract":"-",containValue:"true"},{regExp:/^\*$/,"abstract":"*",containValue:"true"},{regExp:/^\/$/,"abstract":"/",containValue:"true"},{regExp:/^[a-zA-Z][a-zA-Z0-9]*$/,"abstract":"ID",containValue:"true"},{regExp:/^<=$/,"abstract":"<=",containValue:"true"},{regExp:/^<$/,"abstract":"<",containValue:"true"},{regExp:/^\=\=$/,"abstract":"==",containValue:"true"},{regExp:/^>=$/,"abstract":">=",containValue:"true"},{regExp:/^>$/,"abstract":">",containValue:"true"},{regExp:/^!=$/,"abstract":"!=",containValue:"true"},{regExp:/^\=$/,"abstract":"=",containValue:"true"},{regExp:/^[0-9]*\.[0-9]+$/,"abstract":"NUM",containValue:"true"},{regExp:/^[0-9]+\.?$/,"abstract":"NUM",containValue:"true"}],c={"new":function(){var e,t,n,r,i={};return i.reset=function(){e=1,n=1,t=1,r=1},i.shift=function(e){r+=e},i.newLine=function(){r=1,n++},i.reduce=function(){e=n,t=r},i.get=function(){return{first_row:e,last_row:n,first_col:t,last_col:r}},i}},u=c["new"](),f=SymbolTable["new"](),p={},m=["NORMAL","ERROR","DONE"],d=!1,h=0;return p.getErrMsg=function(){return n},p.getStatus=function(){return e},p.getSymbolTable=function(){return f.get()},p.setInput=function(t){p.reset(),r=t,e=m[0]},p.reset=function(){f.reset(),u.reset(),n="",t=[],i="",h=0,e=m[2],d=!1},p.lexDone=function(){return e==m[2]},p.lex=function(c){function p(e){var t;for(t=0;t<l.length;t+=1)if(l.hasOwnProperty(t)&&e.match(l[t].regExp))return{lexeme:e,"abstract":l[t]["abstract"],position:u.get(),containValue:l[t].containValue};return!1}if(e!=m[0])return!1;for(i="";h<r.length;){if(a=r[h],o=p(i+a))i+=a,u.shift(1);else{if("NUM"==p(i)["abstract"]&&"ID"==p(a)["abstract"])return n="UNDEFINED SYMBOL '"+i+a+"' AT ROW "+u.get().first_row+", COL "+u.get().first_col,e=m[1],!1;if(""==i)if(null!=a.match(/\ /))u.shift(1);else if(null!=a.match(/\t/))u.shift(4);else{if(null==a.match(/\n/))return n="UNDEFINED SYMBOL '"+a+"' AT ROW "+u.get().first_row+", COL "+u.get().first_col,e=m[1],!1;u.newLine()}else if(h-=1,s=p(i),t.push(s),"ID"==s["abstract"]&&f.handle(s),c)return u.reduce(),i="",h+=1,!0;u.reduce(),i=""}h+=1}return(s=p(i))?(t.push(s),!0):(u.reduce(),s={lexeme:"$","abstract":"$",position:u.get()},t.push(s),e=m[2],!0)},p.getToken=function(){return s},p.getSequence=function(){return t},p.getSequenceByAbstract=function(){var e,n="";for(e=0;e<t.length;e+=1)n+=t[e]["abstract"]+" ";return n},p.getSequenceByLexeme=function(){var e,n="";for(e=0;e<t.length;e+=1)n+=t[e].lexeme+" ";return n},p}},Parser={"new":function(){var e,t,n,r,i,o,a,s,l,c,u,f,p,m,d,h,v=[{},{interminal:"program",product:["compoundstmt"]},{interminal:"stmt",product:["decl"]},{interminal:"stmt",product:["ifstmt"]},{interminal:"stmt",product:["whilestmt"]},{interminal:"stmt",product:["assgstmt"]},{interminal:"stmt",product:["compoundstmt"]},{interminal:"compoundstmt",product:["{","stmts","}"]},{interminal:"stmts",product:["stmt","stmts"]},{interminal:"stmts",product:[]},{interminal:"ifstmt",product:["if","(","boolexpr",")","then","stmt","else","stmt"]},{interminal:"whilestmt",product:["while","(","boolexpr",")","stmt"]},{interminal:"assgstmt",product:["ID","=","arithexpr",";"]},{interminal:"decl",product:["type","list",";"]},{interminal:"type",product:["int"]},{interminal:"type",product:["real"]},{interminal:"list",product:["ID","list1"]},{interminal:"list1",product:[",","list"]},{interminal:"list1",product:[]},{interminal:"boolexpr",product:["arithexpr","boolop","arithexpr"]},{interminal:"boolop",product:["<"]},{interminal:"boolop",product:[">"]},{interminal:"boolop",product:["<="]},{interminal:"boolop",product:[">="]},{interminal:"boolop",product:["=="]},{interminal:"arithexpr",product:["multexpr","arithexprprime"]},{interminal:"arithexprprime",product:["+","multexpr","arithexprprime"]},{interminal:"arithexprprime",product:["-","multexpr","arithexprprime"]},{interminal:"arithexprprime",product:[]},{interminal:"multexpr",product:["simpleexpr","multexprprime"]},{interminal:"multexprprime",product:["*","simpleexpr","multexprprime"]},{interminal:"multexprprime",product:["/","simpleexpr","multexprprime"]},{interminal:"multexprprime",product:[]},{interminal:"simpleexpr",product:["ID"]},{interminal:"simpleexpr",product:["NUM"]},{interminal:"simpleexpr",product:["(","arithexpr",")"]}],g={program:{"{":1,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},stmt:{"{":6,"}":0,"if":3,"(":0,")":0,then:0,"else":0,"while":4,"int":2,real:2,ID:5,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},compoundstmt:{"{":7,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},stmts:{"{":8,"}":9,"if":8,"(":0,")":0,then:0,"else":0,"while":8,"int":8,real:8,ID:8,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},ifstmt:{"{":0,"}":0,"if":10,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},whilestmt:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":11,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},assgstmt:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:12,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},decl:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":13,real:13,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},type:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":14,real:15,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},list:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:16,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},list1:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":17,";":18,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},boolexpr:{"{":0,"}":0,"if":0,"(":19,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:19,NUM:19,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},boolop:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":20,">":21,"<=":22,">=":23,"==":24,$:0},arithexpr:{"{":0,"}":0,"if":0,"(":25,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:25,NUM:25,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},arithexprprime:{"{":0,"}":0,"if":0,"(":0,")":28,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":28,"+":26,"-":27,"*":0,"/":0,"=":0,"<":28,">":28,"<=":28,">=":28,"==":28,$:0},multexpr:{"{":0,"}":0,"if":0,"(":29,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:29,NUM:29,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},multexprprime:{"{":0,"}":0,"if":0,"(":0,")":32,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":32,"+":32,"-":32,"*":30,"/":31,"=":0,"<":32,">":32,"<=":32,">=":32,"==":32,$:0},simpleexpr:{"{":0,"}":0,"if":0,"(":35,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:33,NUM:34,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0}},b={"new":function(e,t){var n={},r=[];return n.fatherNode=t,n["abstract"]=e,n.name=Invalid,n.value=Invalid,n.type=Invalid,n.formula=Invalid,n["new"]=!0,n.parsed=!1,n.addSubNode=function(e){r.unshift(e)},n.getSubNodes=function(){return r.slice()},n.setPosition=function(e){n.position=e},n.assign=function(e,t){if(e.containValue)switch(e["abstract"]){case"ID":n.name=e.lexeme,n.type=void 0,n.value=void 0;break;case"NUM":n.type=void 0,n.value=Number(e.lexeme);break;case"type":n.value=e.lexeme.toLowerCase();
}n.formula=t},n.shiftSubNode=function(){r.shift()},y.push(n),n},epsilon:function(){var e={},t=[];return e["abstract"]="ε",e.name=Invalid,e.value=Invalid,e.type=Invalid,e.parsed=!1,e.getSubNodes=function(){return t.slice()},e}},w={},x=["NORMAL","WARNING","ERROR","DONE"],y=[];return w.getStatus=function(){return e},w.reset=function(){parseErr=!1,a=["$","program"],s=[],t=[],r="",i=[],o="",y=[],n=b["new"]("program",b["new"]()),c=[n],p=0,e=x[3],l=[a.slice(),s.slice(),{}],h=!1},w.setInput=function(t){w.reset(),s=t,e=x[0]},w.pushToken=function(e){nextT=e,next=nextT["abstract"],s.push(e)},w.parse=function(n){function w(e){var t;for(t=0;t<v.length;t+=1)if(v[t].interminal==e)return!1;return!0}function N(){for(var e=0;e<y.length;e++)y[e]["new"]=!1;y=[]}if(e!=x[0]&&e!=x[1])return!1;l=[a.slice(),s.slice(),{}];var E=a.pop(),S=s[0],k=S["abstract"];for(u=c.pop();"$"!=E&&s.length>0;){if(N(),E!=k||h){if(h&&"stmts"!=E)e=x[1],o=["UNEXPECTED",S.lexeme,"AT","ROW",f.last_row+",","COL",f.last_col+".","POPPED","OUT","'"+E+"'"].join(" "),l[2]=o,i.push(o),u.parsed=!0;else if(h&&"stmts"==E){if(c.push(d),a.push("stmts"),u!=d)for(;d.getSubNodes().length>0;)d.shiftSubNode();g[E][k]>0?(h=!1,o="RECOVERY DONE",l[2]=o,i.push(o)):(s.shift(),e=x[1],o="SKIPPED '"+k+"' AT ROW "+S.position.first_row+", COL "+S.position.first_col,l[2]=o,i.push(o))}else if(w(E))h=!0,e=x[1],o=["UNEXPECTED",S.lexeme,"AT","ROW",f.last_row+",","COL",f.last_col+".","POPPED","OUT","'"+E+"'"].join(" "),l[2]=o,i.push(o),u.parsed=!0;else if(0==g[E][k])Number(S.position.first_row)>Number(f.last_row)?(e=x[1],o=["EXPECTED",";","AT","ROW",f.last_row+",","COL",f.last_col].join(" "),l[2]=o,i.push(o),s.unshift({lexeme:";","abstract":";",position:f,containValue:!0})):("stmts"!=E&&(h=!0),a.push(E),c.push(u),s.shift(),e=x[1],o="SKIPPED '"+k+"' AT ROW "+S.position.first_row+", COL "+S.position.first_col,l[2]=o,i.push(o));else if(g[E][k]>0){m=g[E][k];var M,$,O=g[E][k],T=v[O].product.slice();for(0==T.length?(u.addSubNode(b.epsilon()),u.parsed=!0):"stmts"==v[O].interminal&&(d=u);T.length>0;)M=T.pop(),a.push(M),$=b["new"](M,u),u.addSubNode($),c.push($);l[2]=v[O]}}else f=S.position,u.setPosition(S.position),u.parsed=!0,u.assign(S,m),s.shift();if(e!=x[2]&&t.push(l),e==x[2]||n)return p+=1,e!=x[2];n||(l=[a.slice(),s.slice(),{}],E=a.pop(),S=s[0],k=S["abstract"])}return E==k&&s.shift(),0==s.length?(t.push(l),e=x[3],!0):(e=x[2],r="CAME UP WITH UNEXPECTED TERMINAL '"+S.lexeme+"' AT ROW "+S.position.first_row+", COL "+S.position.first_col,!1)},w.parseDone=function(){return e==x[3]},w.needPush=function(){return 0==s.length},w.getRootS=function(){function e(t,n){var r={},i=[],o=t.getSubNodes();r["abstract"]=t["abstract"],r.name=t.name,r.value=t.value,r.type=t.type,r.subNodes=i,r.fatherNode=n,void 0!=t.position&&(r.position=t.position);var a;for(a=0;a<o.length;a++)i.push(e(o[a],r));return r}return e(n,void 0)},w.getSequentialNodes=function(){function e(t){var n=t.getSubNodes();if(n.length>0){for(var r=!0,i=0;i<n.length;i++)n[i].parsed||(e(n[i]),n[i].parsed||(r=!1));t.parsed=r}}function t(){function e(n,r,i){var o=t.toString();if(t+=1,typeof r==typeof b["new"]()){var a,s,l,c=[],u=[o,r["abstract"],0,n,i?"1":"0",r["new"]?"1":"0"],f=r.getSubNodes(),p=0;for(s=0;s<f.length;s+=1)if(!f[s].parsed){for(p+=1,a=e(o,f[s],1==p&&i),l=0;l<a.length;l+=1)c.push(a[l]);a.length>0&&(u[2]+=a[0][2]+1)}return c.unshift(u),c}}var t=0;return e("",n,!0)}return e(n),t()},w.treeChanged=function(){return!0},w.getErrMsg=function(){return r},w.getWarningMsg=function(){return i.join("\n")},w.getMovementsF=function(){function e(e,t){for(;e.length<t;)e+=" ";return e}var n,r,i,o,a,s,l,c=[],u=0,f=0,p=0,m=22;for(s=0;s<t.length;s+=1){for(n=t[s],r=[],i=n[0].join(" "),u=Math.max(u,i.length),r.push(i),o="| ",l=0;l<n[1].length;l+=1)o+=n[1][l].lexeme+" ";o=o.indexOf(";")>-1?o.split(";")[0]+";":o.split(";")[0],o.length>m&&(o=o.substring(0,m)+" ..."),f=Math.max(f,o.length),r.push(o),a="| ",n[2].hasOwnProperty("interminal")?(a+=n[2].interminal+" -> ",a+=n[2].product.length>0?n[2].product.join(" "):"ε",p=Math.max(p,a.length)):"string"==typeof n[2]&&(a+=n[2]),r.push(a),c.push(r)}var s;for(s=0;s<c.length;s+=1)c[s][0]=e(c[s][0],u),c[s][1]=e(c[s][1],f),c[s][2]=e(c[s][2],p);var s,d="\n"+[e("STACK",u),e("INPUT",f),e("ACTION",p)].join("    ")+"\n";for(s=0;s<c.length;s+=1)d+=[c[s][0],c[s][1],c[s][2]].join("    ")+"\n";return d},w.getCurMovementF=function(){var e,t=l[0].join(" "),n="";for(e=0;e<l[1].length;e++)n+=l[1][e].lexeme+" ";n.length>20&&(n=n.substring(0,17)+" ...");var r="";if(l[2].hasOwnProperty("interminal")){if(r=l[2].interminal+" -> ",l[2].hasOwnProperty("product")){0==l[2].product.length&&(r+="ε");for(var e=0;e<l[2].product.length;e++)r+=l[2].product[e]+" "}}else"string"==typeof l[2]&&(r+=l[2]);return[t,n,r].join("  |  ")},w}},Paxer={"new":function(){var e,t,n,r={},i=Parser["new"](),o=Lexer["new"](),a=["NORMAL","WARNING","ERROR","DONE"];return r.reset=function(){t="",n="",e=a[3],o.reset(),i.reset()},r.setInput=function(t){function n(e){for(var t,n="",r=!1,i=0,o=0;o<e.length;o++)t=e[o],"/"==t?i+=1:i=0,"\n"==t&&(r=!1),2==i&&(r=!0),r||(n+=t);return n}r.reset(),o.setInput(n(t)),i.setInput([]),e=a[0]},r.go=function(){if(e==a[0]||e==a[1]){e=a[0];var r=!0;if(i.needPush())switch(o.getStatus()){case"DONE":return;case"ERROR":return t=o.getErrMsg(),void(e=a[2]);case"NORMAL":o.lex(r),i.pushToken(o.getToken());break;default:return console.log("UNEXPECTED LEXER STATUS"),void(e=a[2])}switch(i.parse(r),i.getStatus()){case"DONE":break;case"ERROR":return t=i.getErrMsg(),void(e=a[2]);case"WARNING":n=i.getWarningMsg(),e=a[1];case"NORMAL":break;default:console.log("UNEXPECTED PARSER STATUS"),e=a[2]}o.lexDone()!=i.parseDone()&&(e=a[2]),o.lexDone()&&i.parseDone()&&(e=a[3])}},r.getStatus=function(){return e},r.getErrMsg=function(){return t},r.getWarningMsg=i.getWarningMsg,r.getSymbolTable=o.getSymbolTable,r.getSequentialNodes=i.getSequentialNodes,r.getMovementsF=i.getMovementsF,r.getCurMovementF=i.getCurMovementF,r.getRootS=i.getRootS,r.getTreeChanged=i.getTreeChanged,r}};SemanticError.prototype.toString=function(){var e="Error: "+this.msg;return this.position&&(e=[e," at line: ",this.position.first_row,", ch: ",this.position.first_col].join("")),e},$(function(){ko.applyBindings(window.mainView=new MainViewModel),window.onbeforeunload=function(){return mainView.editor.unsaved()?"未保存的修改将丢失":void 0},window.onunload=function(){mainView.editor.save(),mainView.fileManager.save()},$(document).on("contextmenu",function(){return!1}),context.init({fadeSpeed:0,above:"auto",preventDoubleContext:!0}),context.attach("#file-list",[{text:"New File...",action:function(e){mainView.editor.openNewFile()}},{divider:!0},{text:"Rename",action:function(e){var t=$("#file-list").children(".active"),n=t.attr("id"),r=n.replace(/^toy\-/,"")+".toy";mainView.workspace.renameFile(r)}},{text:"Delete",action:function(e){var t=$("#file-list").children(".active"),n=t.attr("id").replace(/^toy\-/,""),r=n+".toy";mainView.workspace.confirmDeleteFile(r)}}]),context.attach(".left-box .box-body",[{text:"New File...",action:function(e){mainView.editor.openNewFile()}}]),mainView.console.log("Compiler lauched at "+(new Date).toTimeString()),$(".loading-mask").remove()});