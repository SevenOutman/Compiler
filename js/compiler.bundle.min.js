function ToyFile(e,t,n){this.isNewFile=void 0!==n?n:!0,this.name=void 0!==e?e.replace(/(\.toy)$/,""):"untitled",this.content=t||"",this.tree=null,this.assembly=null}function TreeFile(e,t){this.origin=e||new ToyFile,this.nodeArr=t||[]}function AssemblyFile(e){this.origin=e||new ToyFile}function SemanticAnalyzer(){function e(e,t,n,i){var r=null===t?"":t,o=null===n?"":n,a=null===i?"":i;return"    "+e+" "+r+", "+o+", "+a}function t(e){return"f"+e}function n(e){return"t"+e}function i(u){var d=o.rear();switch(o.push(u),u["abstract"]){case"program":i(u.subNodes[0]);break;case"compoundstmt":i(u.subNodes[1]);break;case"stmts":i(u.subNodes[0]),u.subNodes[1]&&i(u.subNodes[1]);break;case"stmt":i(u.subNodes[0]);break;case"decl":u.value=i(u.subNodes[0]).value,i(u.subNodes[1]);break;case"type":u.value=u.subNodes[0]["abstract"];break;case"list":u.value=d.value,i(u.subNodes[0]),i(u.subNodes[1]);break;case"ID":var f=r.get(u.name);switch(void 0===f.occurance?f.occurance=0:f.occurance++,d["abstract"]){case"list":u.type=d.value,f.type&&a.push(new SemanticError("Duplicated declaration of '"+f.name+"'",f.positions[f.occurance])),f.type=u.type;break;case"assgstmt":f.type||0!=f.occurance||a.push(new SemanticError("Undeclared identifier '"+f.name+"'",f.positions[f.occurance]))}break;case"list1":u.value=d.value,u.subNodes[1]&&i(u.subNodes[1]);break;case"assgstmt":u.value=i(u.subNodes[2]).value;var h=i(u.subNodes[0]).name;s[s.length]=e("mov",h,null,u.value);break;case"arithexpr":var p=i(u.subNodes[0]),m=i(u.subNodes[1]);if(m.type)switch(m.type){case"+":u.value=n(l++),s[s.length]=e("add",u.value,p.value,m.value);break;case"-":u.value=n(l++),s[s.length]=e("sub",u.value,p.value,m.value)}else u.value=p.value;break;case"multexpr":var p=i(u.subNodes[0]),m=i(u.subNodes[1]);if(m.type)switch(m.type){case"*":u.value=n(l++),s[s.length]=e("mul",u.value,p.value,m.value);break;case"/":u.value=n(l++),0==m.value?(a.push(new SemanticError("Cannot be divided by 0")),s[s.length]=e("*div",u.value,p.value,m.value)):s[s.length]=e("div",u.value,p.value,m.value)}else u.value=p.value;break;case"arithexprprime":if(u.subNodes[2]){u.type=u.subNodes[0]["abstract"];var p=i(u.subNodes[1]),m=i(u.subNodes[2]);if(m.type)switch(m.type){case"+":u.value=n(l++),s[s.length]=e("add",u.value,p.value,m.value);break;case"-":u.value=n(l++),s[s.length]=e("sub",u.value,p.value,m.value)}else u.value=p.value}break;case"simpleexpr":if(u.subNodes[1])u.value=i(u.subNodes[1]).value;else{var g=u.subNodes[0];switch(g["abstract"]){case"ID":u.value=g.name;break;case"NUM":u.value=g.value}}break;case"multexprprime":if(u.subNodes[2]){u.type=u.subNodes[0]["abstract"];var p=i(u.subNodes[1]),m=i(u.subNodes[2]);if(m.type)switch(m.type){case"*":u.value=n(l++),s[s.length]=e("mult",u.value,p.value,m.value);break;case"/":u.value=n(l++),0==m.value?(a.push(new SemanticError("Cannot be divided by 0")),s[s.length]=e("*div",u.value,p.value,m.value)):s[s.length]=e("div",u.value,p.value,m.value)}else u.value=p.value}break;case"whilestmt":var v=u.subNodes[2],b=u.subNodes[4];s[s.length]=t(c++),i(v),i(b),s[s.length]=e("jmp",null,null,"f"+(c-1));break;case"boolexpr":u.value="t"+l++;var w=u.subNodes[0],x=u.subNodes[1],$=u.subNodes[2],p=i(w),m=i($);switch(i(x).value){case"<":s[s.length]=e("lt",u.value,p.value,m.value);break;case">":s[s.length]=e("gt",u.value,p.value,m.value);break;case"<=":s[s.length]=e("le",u.value,p.value,m.value);break;case">=":s[s.length]=e("ge",u.value,p.value,m.value);break;case"==":s[s.length]=e("eq",u.value,p.value,m.value)}s[s.length]=e("jmpf",u.value,null,"f"+c);break;case"boolop":u.value=u.subNodes[0]["abstract"];break;case"ifstmt":var x=u.subNodes[2],y=u.subNodes[5],C=u.subNodes[7];s[s.length]=t(c++),i(x),i(y),s[s.length]=e("jmp",null,null,"f"+(c+1)),s[s.length]=t(c++),i(C)}return o.pop(),u}var r=null,o=[],a=[],s=[],l=0,c=0,u=function(e,n){l=0,c=0,o=[],a=[],s=[];var u=e;r=n,r.get=function(e){for(var t=0;t<r.length;t++)if(r[t].name==e)return r[t]},i(u),s[s.length]=t(c++),P("symboltablechanged",r)};return{eat:u,getErrorMsg:function(){return a.join("\n")},getAssembly:function(){return s.join("\n")}}}function SemanticError(e,t){this.msg=e,this.position=t}var Benchmark=function(){var e={},t=function(t){e[t]=window.performance?window.performance.now():(new Date).getTime()},n=function(t){var n=window.performance?window.performance.now():(new Date).getTime();return n-e[t]},i=function(e,i,o){t("test");for(var a=0;i>a;a++)e.apply(o||this,Array.prototype.slice.call(arguments,3));var s=n("test");return r("test"),s},r=function(t){delete e[t]};return{mark:t,measure:n,test:i,clear:r}}();const Invalid=void 0;Array.prototype.has=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return!0;return!1},Array.prototype.rear=function(){return this[this.length-1]},Array.prototype.front=function(){return this[0]},Array.prototype.remove=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return this.splice(t,1)},String.prototype.repeat||(String.prototype.repeat=function(e){"use strict";var t="",n=this;if(1>e)return t;for(;e>1;)1&e&&(t+=n),e>>=1,n+=n;return t+n}),Math.mid=function(e,t,n){if(3!=arguments.length)throw new Error("Math.mid requires exactly 3 arguments.");return[e,t,n].sort(function(e,t){return e-t})[1]};var _randomString=function(){function e(e){for(var t="";t.length<e;){var n=Math.floor(26*Math.random()),i=Math.random()<.5?0:1;t+=String.fromCharCode(65+n+32*i)}return t}function t(e){for(var t="";t.length<e;){var n=Math.floor(52*Math.random());t+=String.fromCharCode(65+(n>25?n+6:n))}return t}function n(n){if(n>5)return e(n-5)+t(5);for(var i,r,o="",a=Math.pow(64,n),s=Math.floor(Math.random()*a),l=51/63;o.length<n;)i=s%64,r=Math.floor(i*l),s=(s-i)/64,o+=String.fromCharCode(65+(r>25?r+6:r));return o}return n}();!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("toy",function(e,t){function n(e,t){var n=e.next();return a.test(n)?(e.eatWhile(/^[*+\-<>!=]/),"operator"):/\d/.test(n)?(e.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/),"number"):r.test(n)?(e.eatWhile(r),o.test(e.current())?"keyword":"variable"):null}var i=e.indentUnit,r=t.wordCharacters||/[\w$\xa1-\uffff]/,o=/\b(int|real|if|else|then|while)\b/,a=/^(\+|\-|\*|\/|>=?|<=?|==?)$/;return{startState:function(){return{indentStack:[]}},token:function(e,t){if(e.eatSpace())return null;var i=n(e,t),r=e.current();return["{","then","else"].has(r)?("{"==r&&"{"!=t.indentStack.rear()&&t.indentStack.pop(),t.indentStack.push(r)):"}"===r?"{"==t.indentStack.rear()&&t.indentStack.pop():";"===r&&["else","then"].has(t.indentStack.rear())&&t.indentStack.pop(),i},indent:function(e,t){var n=t&&t.charAt(0);return"}"==n&&"{"==e.indentStack.rear()&&e.indentStack.pop(),e.indentStack.length*i},electricInput:/^\s*(?:\{|})$/}})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("console",function(e,t){var n={"+":"positive","-":"negative",":":"comment","@":"def"};return{startState:function(){return{ctx:n[":"]}},token:function(e,t){var i=e.string.search(/[\t ]+?$/);if(!e.sol()||0===i)return e.skipToEnd(),t.ctx;var r=n[e.peek()]||e.skipToEnd();-1===i?e.skipToEnd():e.pos=i;var o=t.ctx=r||t.ctx;return o}}})}),function(e){var t={},n=function(e,n){if(e&&t[e])for(var i=0;i<t[e].length;i++)setTimeout(function(e,t){return function(){e.apply(t,n)}}(t[e][i],this),0)},i=function(e,n){"function"==typeof n&&(t[e]||(t[e]=[]),t[e].push(n))};e.P=function(e){return n(e,Array.prototype.slice.call(arguments,1)),{p:P}},e.S=function(e,t){return i(e,t),{s:S}}}(window);var Storage=function(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),t}catch(n){return t=function(){var e={};return{setItem:function(t,n){return e[t]=String(n)},getItem:function(t){return e.hasOwnProperty(t)?this._data[t]:void 0},removeItem:function(t){return delete e[t]},clear:function(){return e={}}}}()}}(),Cache={};ToyFile.prototype.extension=".toy",ToyFile.prototype.fileName=function(){return this.isNewFile?this.name:this.name+this.extension},ToyFile.prototype.serialize=function(){return JSON.stringify({name:this.name,content:this.content})},TreeFile.prototype.fileName=function(){return this.origin.name+".tree"};var View=function(){function e(e){this.id=_randomString(8),this.file=e,this.saved=!0,this.content=e.content,this.history={done:[],undone:[]},this.cursorPosition={line:0,ch:0}}function t(e,t){return e+t.replace(/\s*\n/g,"\n  ")+"\n"}function n(e,t){return lines=e.split("\n").slice(-t).join("\n")}var i={};i.cm=CodeMirror.fromTextArea(document.getElementById("editor"),{lineNumbers:!0,mode:"toy",indentUnit:4,theme:"monokai-so",autoCloseBrackets:!0,matchBrackets:!0,styleActiveLine:!0,showCursorWhenSelecting:!0,scrollbarStyle:"overlay",selectionPointer:!0,styleSelectedText:!0}),i.cm.on("change",function(e,t){var n=i.currentSession();return null===n?void document.getElementById("btn-save").classList.remove("unsaved"):(n.saved&&(n.saved=!1),void(document.getElementById("btn-save").classList.hasOwnProperty("unsaved")||document.getElementById("btn-save").classList.add("unsaved")))}),i.cm.on("cursorActivity",function(e){var t=e.doc.getCursor();$("#current-line").text(t.line+1),$("#current-ch").text(t.ch+1)}),i.getContent=function(){return i.cm.getValue()},i.setContent=function(e){return i.cm.setValue(e)},i.openedSessions=[],i.openedSessions.find=function(e){for(var t=0;t<this.length;t++)if(this[t].id===e)return this[t];return null}.bind(i.openedSessions),i.openedSessions.findFile=function(e){for(var t=0;t<this.length;t++)if(this[t].file.fileName()===e)return this[t];return null}.bind(i.openedSessions),i.currentSession=function(){var e=null;return function(t){if(t&&t!==e){null!==e&&(e.content=i.getContent(),e.history=i.cm.doc.getHistory(),e.cursorPosition=i.cm.doc.getCursor()),e=t,i.setContent(e.content),i.cm.doc.setHistory(e.history),i.cm.doc.setCursor(e.cursorPosition);var n="session-"+e.id,r=$("#"+n);if(r.length<1){var o=$("<a></a>").text(t.file.fileName()),a=$("<span></span>").addClass("tab-dismiss").html("&times;");r=$("<div></div>").attr("id",n).addClass("tab-cell"),a.on("click",function(e){return function(){return View.editor.closeSession(e),!1}}(t)),r.on("click",function(e){return function(){i.bringSessionToFront(e)}}(t)),$(".tab-group").append(r.append(o.append(a)))}r.hasClass("active")||(r.siblings(".active").removeClass("active"),r.addClass("active"))}else null===t&&(e=null,i.setContent(""),$(".editor-placeholder").show(),$("#cursor-position").hide());return e}}(),i.bringSessionToFront=function(e){var t=e.saved;i.currentSession(e),i.cm.focus(),t&&View.editor.save(!0)},i.closeSession=function(e){i.openedSessions.remove(e);var t="session-"+e.id,n=$("#"+t);if(n.remove(),i.currentSession()==e){var r=i.openedSessions.front();void 0===r?i.currentSession(null):i.bringSessionToFront(r)}},i.openFile=function(t){$(".editor-placeholder").hide(),$("#cursor-position").show();var n=t.isNewFile?null:i.openedSessions.findFile(t.fileName());null===n&&(n=new e(t),i.openedSessions.push(n));var r="toy-"+t.name,o=$("#"+r);o.trigger("click"),i.bringSessionToFront(n)},i.newFile=function(){i.openFile(new ToyFile)};var r=document.createElement("div"),o=document.createElement("input"),a=document.createElement("span");r.id="dialog-save",r.innerHTML="File name: ",o.size="untitled".length,o.value="untitled",o.oninput=function(){o.size=Math.max(o.value.length,1)},a.innerHTML=".toy",r.appendChild(o),r.appendChild(a),i.save=function(e){var t=i.currentSession();if(t){if(!e&&t.file.isNewFile)return void i.dialogRenameFile(t.file);(e||!t.saved)&&(t.file.content=t.content=i.getContent(),Storage.setItem(t.file.fileName(),t.file.serialize()),e||l.log("Saved to '"+t.file.fileName()+"'"),t.saved=!0,document.getElementById("btn-save").classList.remove("unsaved"))}},i.needSave=function(){return i.currentSession()?!i.currentSession().saved:!1};var s=null;i.dialogRenameFile=function(e){s=e,null!==s&&($("#filename").val(e.name),$("#dialog-mask").show(),$("#filename").select())},i.confirmRename=function(){if(null!==s){var e=$("#filename").val();if(null!==Cache.files.find(e+".toy")&&!confirm("File '"+e+".toy' already exists. Want to overwrite?"))return $("#filename").select(),!1;$("#dialog-mask").hide(),$("#filename").val("");var t="toy-"+s.name;if(s.name=e,s.isNewFile){if(s.isNewFile=!1,i.save(),Cache.files.push(s),t="toy-"+e,$("#"+t).length<1){var n=$("<li></li>").attr("id",t).text(s.fileName()),r=$("<span></span>").addClass("glyphicon glyphicon-file");n.on("click",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active"))}).on("contextmenu",function(){$(this).trigger("click")}).on("dblclick",function(e){return function(){View.editor.openFile(e)}}(s)),$("#file-list").append(n.prepend(r))}}else{var n=$("#"+t),r=$("<span></span>").addClass("glyphicon glyphicon-file");n.attr("id","toy-"+e).text(s.fileName()).prepend(r)}var o=i.openedSessions.findFile(s.fileName());if(o){var a=i.cm.doc.getCursor();i.closeSession(o),i.openFile(s),i.cm.doc.setCursor(a)}s=null}};var l={};l.cm=CodeMirror.fromTextArea(document.getElementById("console"),{theme:"monokai-so",mode:"console",readOnly:"nocursor",scrollbarStyle:"overlay",viewportMargin:1/0}),l.scollToEnd=function(){l.cm.scrollIntoView(l.cm.doc.lastLine(),1)},l.cm.on("change",function(e){e.scrollIntoView(e.doc.lastLine(),1)}),l.log=function(e){l.cm?l.cm.setValue(n(l.cm.getValue()+t(": ",e),1e3)):window.console.log(e)},l.error=function(e){e&&(l.cm?(e instanceof Object&&(e=e.toString()),l.cm.setValue(n(l.cm.getValue()+t("- ",e),1e3))):window.console.log(e))},l.success=function(e){e&&(l.cm?l.cm.setValue(n(l.cm.getValue()+t("+ ",e),1e3)):window.console.log(e))},l.warn=function(e){e&&(l.cm?l.cm.setValue(n(l.cm.getValue()+t("@ ",e),1e3)):window.console.log(e))},l.popup=function(){$("#box-opener-console").trigger("click")};var c={};c.compiling=null,c.compilie=function(e){c.compiling=e,c.enterCompileMode()},c.enterCompileMode=function(){if(null!==c.compiling){$("body").addClass("compiling"),$("#compiling-filename").text(c.compiling.fileName()),$("#editing-btn-group").hide(),$("#compiling-btn-group").show(),$(".tab-bar-cover").show(),$(".tree-box").removeClass("assembly"),d.cm.setValue(""),$("#box-opener-tree").trigger("click"),$("#box-opener-structure").trigger("click");var e=$(".bottom-box");e.hasClass("hidden")&&e.removeClass("hidden"),e.css("height","30%"),$(".upper-box").css("height","70%"),u.clear().setOptions({width:$(".tree-box .box-body").width(),height:$(".tree-box .box-body").height()}),u.setSource([["0","program",1,"","1","0"]]),u.render(),$(".tree-box .placeholder").hide(),$(".left-box .box-caret").trigger("click"),i.cm.setOption("readOnly","nocursor"),l.cm.setValue("")}},c.exitCompileMode=function(){$("body").removeClass("compiling"),$("#compiling-btn-group").hide(),$("#editing-btn-group").show(),$(".tab-bar-cover").hide(),$("#box-opener-workspace").trigger("click"),$(".right-box .box-caret").trigger("click"),$(".tree-box .box-caret").trigger("click"),$(".bottom-box").hasClass("hidden")||($(".bottom-box").css("height","30%"),$(".upper-box").css("height","70%")),i.cm.setOption("readOnly",!1),c.compiling=null,$("#compiling-filename").text("")};var u=new Tree("tree-pane",{radius:10});u.clear=function(){return u.canvas.clear(),u},S("treeboxresized",function(){u.render({width:$(".tree-box .box-body").width(),height:$(".tree-box .box-body").height()})});var d={};return d.cm=CodeMirror.fromTextArea(document.getElementById("assembly"),{theme:"monokai-so",mode:"console",readOnly:"nocursor",scrollbarStyle:"overlay",viewportMargin:1/0}),{assembly:d,editor:i,console:l,control:c,treePen:u}}(),SymbolTable={"new":function(){var e,t,n={},i=0;return n.handle=function(n){function r(n){var r={name:n.lexeme,type:void 0,value:void 0,positions:[n.position]};e[e.length]=r,t[n.lexeme]=i,i++}function o(n){var i=e[t[n.lexeme]].positions;i[i.length]=n.position}e[t[n.lexeme]]?o(n):r(n)},n.reset=function(){e=[],t={},i=0},n.get=function(){return e.slice()},n.getLength=function(){return i},n}},Lexer={"new":function(){var e,t,n,i,r,o,a,s,l=[{regExp:/^int$/,"abstract":"int",containValue:"false"},{regExp:/^real$/,"abstract":"real",containValue:"false"},{regExp:/^if$/,"abstract":"if",containValue:"false"},{regExp:/^then$/,"abstract":"then",containValue:"false"},{regExp:/^else$/,"abstract":"else",containValue:"false"},{regExp:/^while$/,"abstract":"while",containValue:"false"},{regExp:/^\($/,"abstract":"(",containValue:"true"},{regExp:/^\)$/,"abstract":")",containValue:"true"},{regExp:/^\{$/,"abstract":"{",containValue:"true"},{regExp:/^}$/,"abstract":"}",containValue:"true"},{regExp:/^,$/,"abstract":",",containValue:"true"},{regExp:/^;$/,"abstract":";",containValue:"true"},{regExp:/^\+$/,"abstract":"+",containValue:"true"},{regExp:/^-$/,"abstract":"-",containValue:"true"},{regExp:/^\*$/,"abstract":"*",containValue:"true"},{regExp:/^\/$/,"abstract":"/",containValue:"true"},{regExp:/^[a-zA-Z][a-zA-Z0-9]*$/,"abstract":"ID",containValue:"true"},{regExp:/^<=$/,"abstract":"<=",containValue:"true"},{regExp:/^<$/,"abstract":"<",containValue:"true"},{regExp:/^==$/,"abstract":"==",containValue:"true"},{regExp:/^>=$/,"abstract":">=",containValue:"true"},{regExp:/^>$/,"abstract":">",containValue:"true"},{regExp:/^!=$/,"abstract":"!=",containValue:"true"},{regExp:/^=$/,"abstract":"=",containValue:"true"},{regExp:/^[0-9]*\.[0-9]+$/,"abstract":"NUM",containValue:"true"},{regExp:/^[0-9]+\.?$/,"abstract":"NUM",containValue:"true"}],c={"new":function(){var e,t,n,i,r={};return r.reset=function(){e=1,n=1,t=1,i=1},r.shift=function(e){i+=e},r.newLine=function(){i=1,n++},r.reduce=function(){e=n,t=i},r.get=function(){return{first_row:e,last_row:n,first_col:t,last_col:i}},r}},u=c["new"](),d=SymbolTable["new"](),f={},h=["NORMAL","ERROR","DONE"],p=0;return f.getErrMsg=function(){return n},f.getStatus=function(){return e},f.getSymbolTable=function(){return d.get()},f.setInput=function(t){f.reset(),i=t,e=h[0]},f.reset=function(){d.reset(),u.reset(),n="",t=[],r="",p=0,e=h[2]},f.lexDone=function(){return e==h[2]},f.lex=function(c){function f(e){var t;for(t=0;t<l.length;t+=1)if(l.hasOwnProperty(t)&&e.match(l[t].regExp))return{lexeme:e,"abstract":l[t]["abstract"],position:u.get(),containValue:l[t].containValue};return!1}if(e!=h[0])return!1;for(r="";p<i.length;){if(a=i[p],o=f(r+a))r+=a,u.shift(1);else{if(""==r)if(null!=a.match(/[ ]/))u.shift(1);else if(null!=a.match(/\t/))u.shift(4);else{if(null==a.match(/\n/))return n="UNDEFINED SYMBOL '"+a+"' AT ROW "+u.get().first_row+", COL "+u.get().first_col,e=h[1],!1;u.newLine()}else if(p-=1,s=f(r),t.push(s),"ID"==s["abstract"]&&d.handle(s),c)return u.reduce(),r="",p+=1,!0;u.reduce(),r=""}p+=1}return(s=f(r))?(t.push(s),!0):(u.reduce(),s={lexeme:"$","abstract":"$",position:u.get()},t.push(s),e=h[2],!0)},f.getToken=function(){return s},f.getSequence=function(){return t},f.getSequenceByAbstract=function(){var e,n="";for(e=0;e<t.length;e+=1)n+=t[e]["abstract"]+" ";return n},f.getSequenceByLexeme=function(){var e,n="";for(e=0;e<t.length;e+=1)n+=t[e].lexeme+" ";return n},f}},Parser={"new":function(){var e,t,n,i,r,o,a,s,l,c,u,d,f,h,p,m,g,v=[{},{interminal:"program",product:["compoundstmt"]},{interminal:"stmt",product:["decl"]},{interminal:"stmt",product:["ifstmt"]},{interminal:"stmt",product:["whilestmt"]},{interminal:"stmt",product:["assgstmt"]},{interminal:"stmt",product:["compoundstmt"]},{interminal:"compoundstmt",product:["{","stmts","}"]},{interminal:"stmts",product:["stmt","stmts"]},{interminal:"stmts",product:[]},{interminal:"ifstmt",product:["if","(","boolexpr",")","then","stmt","else","stmt"]},{interminal:"whilestmt",product:["while","(","boolexpr",")","stmt"]},{interminal:"assgstmt",product:["ID","=","arithexpr",";"]},{interminal:"decl",product:["type","list",";"]},{interminal:"type",product:["int"]},{interminal:"type",product:["real"]},{interminal:"list",product:["ID","list1"]},{interminal:"list1",product:[",","list"]},{interminal:"list1",product:[]},{interminal:"boolexpr",product:["arithexpr","boolop","arithexpr"]},{interminal:"boolop",product:["<"]},{interminal:"boolop",product:[">"]},{interminal:"boolop",product:["<="]},{interminal:"boolop",product:[">="]},{interminal:"boolop",product:["=="]},{interminal:"arithexpr",product:["multexpr","arithexprprime"]},{interminal:"arithexprprime",product:["+","multexpr","arithexprprime"]},{interminal:"arithexprprime",product:["-","multexpr","arithexprprime"]},{interminal:"arithexprprime",product:[]},{interminal:"multexpr",product:["simpleexpr","multexprprime"]},{interminal:"multexprprime",product:["*","simpleexpr","multexprprime"]},{interminal:"multexprprime",product:["/","simpleexpr","multexprprime"]},{interminal:"multexprprime",product:[]},{interminal:"simpleexpr",product:["ID"]},{interminal:"simpleexpr",product:["NUM"]},{interminal:"simpleexpr",product:["(","arithexpr",")"]}],b={program:{"{":1,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},stmt:{"{":6,"}":0,"if":3,"(":0,")":0,then:0,"else":0,"while":4,"int":2,real:2,ID:5,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},compoundstmt:{"{":7,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},stmts:{"{":8,"}":9,"if":8,"(":0,")":0,then:0,"else":0,"while":8,"int":8,real:8,ID:8,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},ifstmt:{"{":0,"}":0,"if":10,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},whilestmt:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":11,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},assgstmt:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:12,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},decl:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":13,real:13,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},type:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":14,real:15,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},list:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:16,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},list1:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":17,";":18,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},boolexpr:{"{":0,"}":0,"if":0,"(":19,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:19,NUM:19,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},boolop:{"{":0,"}":0,"if":0,"(":0,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":20,">":21,"<=":22,">=":23,"==":24,$:0},arithexpr:{"{":0,"}":0,"if":0,"(":25,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:25,NUM:25,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},arithexprprime:{"{":0,"}":0,"if":0,"(":0,")":28,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":28,"+":26,"-":27,"*":0,"/":0,"=":0,"<":28,">":28,"<=":28,">=":28,"==":28,$:0},multexpr:{"{":0,"}":0,"if":0,"(":29,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:29,NUM:29,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0},multexprprime:{"{":0,"}":0,"if":0,"(":0,")":32,then:0,"else":0,"while":0,"int":0,real:0,ID:0,NUM:0,",":0,";":32,"+":32,"-":32,"*":30,"/":31,"=":0,"<":32,">":32,"<=":32,">=":32,"==":32,$:0},simpleexpr:{"{":0,"}":0,"if":0,"(":35,")":0,then:0,"else":0,"while":0,"int":0,real:0,ID:33,NUM:34,",":0,";":0,"+":0,"-":0,"*":0,"/":0,"=":0,"<":0,">":0,"<=":0,">=":0,"==":0,$:0}},w={"new":function(e,t){var n={},i=[];return n.fatherNode=t,n["abstract"]=e,n.name=Invalid,n.value=Invalid,n.type=Invalid,n.formula=Invalid,n["new"]=!0,n.parsed=!1,n.addSubNode=function(e){i.unshift(e)},n.getSubNodes=function(){return i.slice()},n.setPosition=function(e){n.position=e},n.assign=function(e,t){if(e.containValue)switch(e["abstract"]){case"ID":n.name=e.lexeme,n.type=void 0,n.value=void 0;break;case"NUM":n.type=void 0,n.value=Number(e.lexeme);break;case"type":n.value=e.lexeme.toLowerCase()}n.formula=t},n.shiftSubNode=function(){i.shift()},y.push(n),n},epsilon:function(){var e={},t=[];return e["abstract"]="ε",e.name=Invalid,e.value=Invalid,e.type=Invalid,e.parsed=!1,e.getSubNodes=function(){return t.slice()},e}},x={},$=["NORMAL","WARNING","ERROR","DONE"],y=[];return x.getStatus=function(){return t},x.reset=function(){s=!1,l=["$","program"],c=[],n=[],r="",o=[],a="",y=[],i=w["new"]("program",w["new"]()),d=[i],p=0,t=$[3],u=[l.slice(),c.slice(),{}],e=!1},x.setInput=function(e){x.reset(),c=e,t=$[0]},x.pushToken=function(e){c.push(e)},x.parse=function(i){function s(e){for(var t=0,n=v.length;n>t;t++)if(v[t].interminal==e)return!1;return!0}function x(e,t){for(var n,i;"$"!=n&&t.length>0;)if(i=t[0]["abstract"],n=e.pop(),n==i)t.shift();else{if(s(n))return!1;if(0==b[n][i])return!1;if(b[n][i]>0){A=b[n][i];for(var r=v[A].product.slice();r.length>0;)e.push(r.pop())}}return 0==t.length}function C(){for(var e=0;e<y.length;e++)y[e]["new"]=!1;y=[]}if(t!=$[0]&&t!=$[1])return!1;u=[l.slice(),c.slice(),{}];for(var S=l.pop(),N=c[0],k=N["abstract"];"$"!=S&&c.length>0;){if(C(),S==k)h=N.position,f=d.pop(),f.setPosition(N.position),f.parsed=!0,f.assign(N,m),c.shift();else if(s(S)||e){e=!0,t=$[1],a=["UNEXPECTED",N.lexeme,"AT","ROW",h.last_row+",","COL",h.last_col+".","POPPED","OUT","'"+S+"'"].join(" "),u[2]=a,o.push(a),f.parsed=!0,f=d.pop();var E=l.pop();if("stmts"==E)for(e=!1,d.push(g);g.getSubNodes().length>0;)g.shiftSubNode();l.push(E)}else if(0==b[S][k])if(l.push(S),i)if("stmts"!=S)a=["UNEXPECTED",N.lexeme,"AT","ROW",h.last_row+",","COL",h.last_col+".","POPPED","OUT","'"+S+"'"].join(" "),u[2]=a,o.push(a),S=l.pop(),f.parsed=!0,f=d.pop();else{for(d.push(g);g.getSubNodes().length>0;)g.shiftSubNode();c.shift(),t=$[1],a="SKIPPED '"+k+"' AT ROW "+N.position.first_row+", COL "+N.position.first_col,o.push(a),u[2]=a}else{var V=!1,M=!1;if(!V&&M){var I;for(R in b[S])if(0!=b[S][R]){I={"abstract":R,lexeme:"*"+R,position:{}};var T=c.slice();if(T.unshift(I),x(l.slice(),T)){V=!0;break}}V&&(c.unshift(I),k=c[0]["abstract"],a="MISSING '"+k+"' AT ROW "+h.last_row+", COL "+h.last_col,o.push(a))}if(!V){for(var T=c.slice(),N=T.shift(),k=N["abstract"],D=[];"$"!=S&&0==b[S][k];)D.push("'"+k+"'"),N=T.shift(),k=N["abstract"];"$"!=S&&(a="SKIPPED "+D.join(", "),o.push(a),V=!0),V&&(T.unshift(N),c=T.slice())}if(!V){var R,O="";for(R in b[S])0!=b[S][R]&&(O+="'"+R+"'|");t=$[2],O=O.substring(0,O.length-1),r="EXPECTING "+O+" AT ROW "+h.last_row+", COL "+h.last_col}V&&(t=$[1],u[2]=a,o.push(a)),t=V?$[1]:$[2]}else if(b[S][k]>0){e=!1,m=b[S][k];var F,P,A=b[S][k],U=v[A].product.slice();for(f=d.pop(),0==U.length?(f.addSubNode(w.epsilon()),f.parsed=!0):"stmts"==v[A].interminal&&(g=f);U.length>0;)F=U.pop(),l.push(F),P=w["new"](F,f),f.addSubNode(P),d.push(P);u[2]=v[A]}if(t!=$[2]&&n.push(u),t==$[2]||i)return p+=1,t!=$[2];i||(u=[l.slice(),c.slice(),{}],S=l.pop(),N=c[0],k=N["abstract"])}return S==k&&c.shift(),f=d.pop(),0==c.length?(n.push(u),t=$[3],!0):(t=$[2],r="CAME UP WITH UNEXPECTED TERMINAL '"+N.lexeme+"' AT ROW "+N.position.first_row+", COL "+N.position.first_col,!1)},x.parseDone=function(){return t==$[3]},x.needPush=function(){return 0==c.length},x.getRootS=function(){function e(t,n){var i={},r=[],o=t.getSubNodes();i["abstract"]=t["abstract"],i.name=t.name,i.value=t.value,i.type=t.type,i.subNodes=r,i.fatherNode=n,void 0!=t.position&&(i.position=t.position);var a;for(a=0;a<o.length;a++)r.push(e(o[a],i));return i}return e(i,void 0)},x.getSequentialNodes=function(){function e(t){var n=t.getSubNodes();if(n.length>0){for(var i=!0,r=0;r<n.length;r++)n[r].parsed||(e(n[r]),n[r].parsed||(i=!1));t.parsed=i}}function t(){function e(n,i,r){var o=t.toString();if(t+=1,typeof i==typeof w["new"]()){var a,s,l,c=[],u=[o,i["abstract"],0,n,r?"1":"0",i["new"]?"1":"0"],d=i.getSubNodes(),f=0;for(s=0;s<d.length;s+=1)if(!d[s].parsed){for(f+=1,a=e(o,d[s],1==f&&r),l=0;l<a.length;l+=1)c.push(a[l]);a.length>0&&(u[2]+=a[0][2]+1)}return c.unshift(u),c}}var t=0;return e("",i,!0)}return e(i),t()},x.treeChanged=function(){return!0},x.getErrMsg=function(){return r},x.getWarningMsg=function(){return o.join("\n")},x.getMovementsF=function(){function e(e,t){return e+" ".repeat(Math.max(0,t-e.length))}for(var t,i,r,o,a,s=[],l=0,c=0,u=0,d=22,f=0,h=n.length;h>f;f++){t=n[f],i=[],r=t[0].join(" "),l=Math.max(l,r.length),i[i.length]=r,o="| ";for(var p=[],m=t[1],g=0,v=m.length;v>g;g++)p[p.length]=m[g].lexeme;o+=p.join(" "),o=o.indexOf(";")>-1?o.split(";")[0]+";":o.split(";")[0],o.length>d&&(o=o.substring(0,d)+" ..."),c=Math.max(c,o.length),i[i.length]=o,a="| ";var b=t[2];b.interminal?(a+=b.interminal+" -> ",a+=b.product.length>0?b.product.join(" "):"ε",u=Math.max(u,a.length)):"string"==typeof b&&(a+=b),i[i.length]=a,s[s.length]=i}for(var f=0,h=s.length;h>f;f++){var w=s[f];w[0]=e(w[0],l),w[1]=e(w[1],c),w[2]=e(w[2],u)}for(var x="\n"+[e("STACK",l),e("INPUT",c),e("ACTION",u)].join("    ")+"\n",$=[],f=0,h=s.length;h>f;f++){var w=s[f];$[$.length]=[w[0],w[1],w[2]].join("    ")}return x+=$.join("\n")},x.getCurMovementF=function(){for(var e,t=u[0].join(" "),n=[],i=0,r=u[1].length;r>i;i++)n[n.length]=u[1][i].lexeme;e=n.join(" "),e.length>20&&(e=e.substring(0,17)+" ...");var o="";if(u[2].interminal){if(o=u[2].interminal+" -> ",u[2].product){0==u[2].product.length&&(o+="ε");for(var a=[],i=0,r=u[2].product.length;r>i;i++)a[a.length]=u[2].product[i];o=a.join(" ")}}else"string"==typeof u[2]&&(o+=u[2]);return[t,e,o].join("  |  ")},x}},Paxer={"new":function(){var e,t,n,i={},r=Parser["new"](),o=Lexer["new"](),a=["NORMAL","WARNING","ERROR","DONE"];return i.reset=function(){t="",n="",e=a[3],o.reset(),r.reset()},i.setInput=function(t){i.reset(),o.setInput(t),r.setInput([]),e=a[0]},i.go=function(){if(e==a[0]||e==a[1]){e=a[0];var i=!0;if(r.needPush())switch(o.getStatus()){case"DONE":return;case"ERROR":return t=o.getErrMsg(),void(e=a[2]);case"NORMAL":o.lex(i),r.pushToken(o.getToken());break;default:return console.log("UNEXPECTED LEXER STATUS"),void(e=a[2])}switch(r.parse(i),r.getStatus()){case"ERROR":return t=r.getErrMsg(),void(e=a[2]);case"WARNING":n=r.getWarningMsg(),e=a[1];break;case"DONE":case"NORMAL":break;default:console.log("UNEXPECTED PARSER STATUS"),e=a[2]}o.lexDone()!=r.parseDone()&&(e=a[2]),o.lexDone()&&r.parseDone()&&(e=a[3])}},i.getStatus=function(){return e},i.getErrMsg=function(){return t},i.getWarningMsg=r.getWarningMsg,i.getSymbolTable=o.getSymbolTable,i.getSequentialNodes=r.getSequentialNodes,i.getMovementsF=r.getMovementsF,i.getCurMovementF=r.getCurMovementF,i.getRootS=r.getRootS,i.getTreeChanged=r.getTreeChanged,i}};SemanticError.prototype.toString=function(){var e="Error: "+this.msg;return this.position&&(e=[e," at line: ",this.position.first_row,", ch: ",this.position.first_col].join("")),e},CodeMirror.commands.save=function(){View.editor.save()},window.onbeforeunload=function(){return View.editor.needSave()?"未保存的修改将丢失":void 0},window.onunload=function(){var e=View.editor.currentSession();e&&e.file?Storage.setItem("last-editing",e.file.fileName()):Storage.removeItem("last-editing");for(var t=[],n=0;n<Cache.files.length;n++)t.push(Cache.files[n].fileName());Storage.setItem("stored-files",JSON.stringify(t))},$(function(){var e=Paxer["new"](),t=new SemanticAnalyzer;document.getElementById("cover-open").onclick=function(){
View.editor.newFile()},Cache.files=[],Cache.files.find=function(e){for(var t=0;t<this.length;t++)if(this[t].fileName()===e)return this[t];return null}.bind(Cache.files),Cache.storedFileNames=JSON.parse(Storage.getItem("stored-files")||"[]");for(var n=0;n<Cache.storedFileNames.length;n++){if($("#file-list").length<1&&Cache.files.length>0){var i=$("<ul></ul>").attr("id","file-list").addClass("list");$(".left-box .placeholder").remove(),i.appendTo($(".left-box .box-body"))}var r=Storage.getItem(Cache.storedFileNames[n]);if(r){var o=JSON.parse(r),a=new ToyFile(o.name,o.content,!1),s="toy-"+a.name;if(Cache.files.push(a),$("#"+s).length<1){var l=$("<li></li>").attr("id",s).text(a.fileName()),c=$("<span></span>").addClass("glyphicon glyphicon-file");l.on("click",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active"))}).on("contextmenu",function(){$(this).trigger("click")}).on("dblclick",function(e){return function(){View.editor.openFile(e)}}(a)),$("#file-list").append(l.prepend(c))}}}var u=Storage.getItem("last-editing");if(u){var a=Cache.files.find(u);a&&(View.editor.openFile(a),$("#toy-"+a.name).trigger("click"))}document.getElementById("btn-tidy").onclick=function(){var e=View.editor.getContent().replace(/\n/g," "),t="",n=/(\+|\-|\*|\/|!=|>=?|<=?|==?)/g,i=/(\(|\)|\{|}|;|\$)/g;e=e.replace(n," $1 ").replace(i," $1 ").replace(/[ ]+/g," ").replace(/(else|then)\s+\{/g,"$1{").replace(/}\s+(else)/,"}$1").trim()+" ",t=e.replace(/(then|else|then\{|else\{|}else\{|\{|}|;)\s/g,"$1\n").replace(/\s+(;|\))/g,"$1").replace(/\(\s+/g,"(").replace(/(then|else)\{/g,"$1 {").replace(/}(else)/,"} $1"),View.editor.setContent(t);for(var r=0;r<View.editor.cm.doc.lastLine();r++)View.editor.cm.indentLine(r,"smart");View.editor.cm.focus()},document.getElementById("btn-compile").onclick=function(){var t=View.editor.currentSession();if(null!==t){Cache.st={},P("symboltablechanged",[]);var n;View.control.compilie(t.file),t.file.isNewFile?(View.console.log("Compile 'untitled'..."),n=View.editor.getContent()):(View.editor.save(),View.console.log("Compile '"+t.file.fileName()+"'..."),n=View.editor.currentSession().content),e.setInput(n)}},$(".tab-new").on("click",function(){View.editor.newFile()});var d=new FileReader,f=null;d.onload=function(){if(null!==f){f.content=this.result,Cache.files.push(f);var e="toy-"+f.name;if($("#"+e).length<1){var t=$("<li></li>").attr("id",e).text(f.fileName()),n=$("<span></span>").addClass("glyphicon glyphicon-file");t.on("click",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active"))}).on("contextmenu",function(){$(this).trigger("click")}).on("dblclick",function(e){return function(){View.editor.openFile(e)}}(f)),$("#file-list").append(t.prepend(n))}View.editor.openFile(f),f=null}},document.getElementById("source_file").onchange=function(){var e=this.files[0];f=new ToyFile(e.name.replace(/(\.\w+)?$/,".toy")),f.isNewFile=!1,d.readAsText(e)},document.getElementById("btn-save").onclick=function(){View.editor.save()};var h=null,p=0,m=0;$.each($(".resizer"),function(e,t){$(t).on("mousedown",function(e){h=t,p=$(h).offset().top-e.clientY,m=$(h).offset().left-e.clientX,$("#resizing-mask").css("cursor",$(h).css("cursor")).show()})}),$(document).on("mouseup",function(){var e=$(h).parent(".resizable");(e.hasClass("bottom-box")||e.hasClass("tree-box"))&&P("treeboxresized"),h=null,$("#resizing-mask").hide()}),document.getElementById("resizing-mask").addEventListener("mousemove",function(e){if(h instanceof HTMLElement){var t=$(h).parent(".resizable");if(t[0]instanceof HTMLElement){var n=$("#main"),i=($(".left-box"),$(".right-box")),r=$(".center-box"),o=$(".upper-box"),a=($(".bottom-box"),$(".editor-box")),s=$(".tree-box");if(t.hasClass("left-box")){var l=e.clientX,c=Math.mid(l+m+5,1,n.width()-i.width()-1);t.width(c-1),r.css("margin-left",c+"px")}if(t.hasClass("right-box")){var l=e.clientX,u=Math.mid(n.width()-(l+m+5),1,n.width()-s.width()-1);t.width(u-1),r.css("margin-right",u+"px")}if(t.hasClass("bottom-box")){var d=e.clientY,f=Math.mid(d+p+5-$(".navbar").height(),0,n.height()-t.children(".box-header").height()-1);t.height(n.height()-f),o.height(f)}if(t.hasClass("tree-box")){var l=e.clientX,u=Math.mid(r.width()-(l+m+5),1,r.width()-1);t.width(u-1),a.css("margin-right",u+"px")}}}},!1),$(document).on("contextmenu",function(){return!1}),context.init({fadeSpeed:0,above:"auto",preventDoubleContext:!0}),context.attach("#file-list",[{text:"New File...",action:function(e){View.editor.newFile()}},{divider:!0},{text:"Rename",action:function(e){var t=$("#file-list").children("li.active"),n=t.attr("id"),i=n.replace(/^toy\-/,"")+".toy";View.editor.dialogRenameFile(Cache.files.find(i))}},{text:"Delete",action:function(e){var t=$("#file-list li.active"),n=t.attr("id").replace(/^toy\-/,""),i=n+".toy",r=Cache.files.find(i);if(confirm("Are you sure to delete '"+r.fileName()+"'?")){r&&Cache.files.remove(r),t.remove();var o=View.editor.openedSessions.findFile(i);o&&View.editor.closeSession(o),Storage.removeItem(i)}}}]),$(document).on("click",function(e){$(".box-open-menu").hide()}),$("#box-opener").on("click",function(e){e.preventDefault(),e.stopPropagation(),$(".box-open-menu").show()}),$("#rename-cancel").on("click",function(e){$("#dialog-mask").hide(),$("#filename").val("")}),$("#rename-confirm").on("click",function(e){View.editor.confirmRename()}),$.each($(".box-open-menu").find("a"),function(e,t){$(t).on("click",function(e,t){e.preventDefault(),e.stopPropagation(),$(".box-open-menu").hide();var n=$(this).attr("id");if("box-opener-console"==n){var i=$(".bottom-box");i.hasClass("hidden")&&(i.removeClass("hidden").css("height","30%"),$(".upper-box").css("height","70%"),t||P("treeboxresized"))}if("box-opener-workspace"==n){var i=$(".left-box");i.hasClass("hidden")&&(i.removeClass("hidden").css("width","200px"),$(".center-box").css("margin-left","200px"))}if("box-opener-structure"==n){var i=$(".right-box");i.hasClass("hidden")&&(i.removeClass("hidden").css("width","350px"),$(".center-box").css("margin-right","350px"))}if("box-opener-tree"==n){var i=$(".tree-box");i.hasClass("hidden")&&(i.removeClass("hidden").css("width","550px"),$(".editor-box").css("margin-right","550px"))}})}),$.each($(".box-caret"),function(e,t){$(t).on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".resizable");t.hasClass("bottom-box")&&(t.hasClass("hidden")||(t.addClass("hidden"),$(".upper-box").css("height","100%"),P("treeboxresized"))),t.hasClass("left-box")&&(t.hasClass("hidden")||(t.addClass("hidden"),$(".center-box").css("margin-left","0"))),t.hasClass("right-box")&&(t.hasClass("hidden")||(t.addClass("hidden"),$(".center-box").css("margin-right","0"))),t.hasClass("tree-box")&&(t.hasClass("hidden")||(t.addClass("hidden"),t.children(".box-body").css("padding-left","0"),$(".editor-box").css("margin-right","0")))})}),$.each($(".box-expand"),function(e,t){$(t).on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".resizable");t.hasClass("bottom-box")&&(t.hasClass("hidden")||($(".upper-box").css("height","0"),t.css("height","100%")))})}),$("#btn-stop").on("click",function(){View.control.exitCompileMode()}),S("symboltablechanged",function(e){var t,n=$(".right-box .box-body"),i=$(".right-box .placeholder"),r={},o={};if($("#symbol-list").length<1?t=$("<ul></ul>").attr("id","symbol-list").addClass("list").appendTo(n):(t=$("#symbol-list"),$.each(t.children("li"),function(e,t){var n=$(t),i=n.attr("data-id"),a=n.children(".li-caret").hasClass("glyphicon-triangle-bottom"),s=n.hasClass("active");r[i]=a,o[i]=s}),t.empty()),e.length<1)t.hide(),i.show();else{for(var a=0;a<e.length;a++){var s=e[a],l="symbol-"+s.name,c=$("<li></li>").attr("data-id",l).html(s.name),u=$("<span></span>").addClass("glyphicon li-caret").addClass(r[l]?"glyphicon-triangle-bottom":"glyphicon-triangle-right").prependTo(c),d="type: "+s.type+", occurance: "+s.positions.length;$("<span></span>").addClass("extra").text(d).appendTo(c);u.on("click",function(){var e=$(this),t=e.parent(),n=e.hasClass("glyphicon-triangle-right");$.each($("[data-pos='"+t.attr("data-id")+"']"),function(e,t){n?$(t).show():$(t).hide()}),e.toggleClass("glyphicon-triangle-right glyphicon-triangle-bottom")}),c.on("click",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active"))}).on("dblclick",function(){$(this).trigger("click"),$(this).children(".li-caret").trigger("click")}).on("click",function(e){return function(){for(var t=0;t<e.positions.length;t++){var n=e.positions[t];0==t?View.editor.cm.doc.setSelection({line:n.first_row-1,ch:n.first_col-1},{line:n.last_row-1,ch:n.last_col-1}):View.editor.cm.doc.addSelection({line:n.first_row-1,ch:n.first_col-1},{line:n.last_row-1,ch:n.last_col-1})}}}(s)).appendTo(t),o[l]&&c.trigger("click");for(var f=0;f<s.positions.length;f++){var h=s.positions[f],p="["+(f+1)+"] line: "+h.first_row+", ch: "+h.first_col,m=$("<li></li>").attr("data-id","pos-"+s.name+"-"+f).attr("data-pos",l).text(p).css("margin-left","30px");r[l]||m.hide(),m.on("click",function(){var e=$(this);e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active"))}).on("click",function(e){return function(){View.editor.cm.doc.setSelection({line:e.first_row-1,ch:e.first_col-1},{line:e.last_row-1,ch:e.last_col-1})}}(h)).appendTo(t),o[m.attr("data-id")]&&m.trigger("click")}}t.show(),i.hide()}});var g=function(e){if(!Cache.st)return Cache.st={},!1;for(var t=0;t<e.length;t++)if(Cache.st[e[t].name]!=e[t].positions.length)return!1;return!0};$("#btn-next").on("click",function(){if("DONE"!=e.getStatus()&&"ERROR"!=e.getStatus()){switch(e.go(),e.getStatus()){case"DONE":return t.eat(e.getRootS(),e.getSymbolTable()),View.console.success(e.getCurMovementF()),View.console.success("code parsed."),View.console.warn(e.getWarningMsg()),View.console.error(t.getErrorMsg()),$(".tree-box").addClass("assembly"),void View.assembly.cm.setValue(t.getAssembly());case"ERROR":return void View.console.error(e.getErrMsg());case"WARNING":case"NORMAL":View.console.success(e.getCurMovementF()),View.treePen.setSource(e.getSequentialNodes()),View.treePen.render()}var n=e.getSymbolTable();if(!g(n)){for(var i=0;i<n.length;i++)Cache.st[n[i].name]=n[i].positions.length;P("symboltablechanged",n)}}}),S("semantichaserror",function(e){for(var t=0;t<e.length;t++)View.console.error(e[t].toString())}),$("#btn-ff").on("click",function(){if("DONE"==e.getStatus())View.console.success("code parsed.");else if("ERROR"==e.getStatus())View.console.error(e.getErrMsg());else{for(Benchmark.mark("parse");"DONE"!=e.getStatus()&&"ERROR"!=e.getStatus();)e.go();switch(e.getStatus()){case"DONE":t.eat(e.getRootS(),e.getSymbolTable());var n=Benchmark.measure("parse");$(".tree-box").addClass("assembly"),View.assembly.cm.setValue(t.getAssembly()),View.console.success(e.getMovementsF()),View.console.warn(e.getWarningMsg()),View.console.error(t.getErrorMsg()),View.console.success("Compile finished in "+n.toFixed(4)+" millisecs."),View.console.success("Can we make it faster?");break;case"ERROR":View.console.error(e.getErrMsg())}}}),$("#about-mask").on("click",function(){$(this).hide()}),$("#about-dialog").on("click",function(e){e.preventDefault(),e.stopPropagation()}),$("#btn-about").on("click",function(){$("#about-mask").show()}),View.console.log("Compiler lauched at "+(new Date).toTimeString())}),$(".loading-mask").remove();